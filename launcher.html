<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Launching Smart Claims - Epic</title>
  <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.min.js"></script>
</head>
<body>
  <h1>Launching Smart Claims (Epic)...</h1>
  <div id="status">Preparing SMART launch...</div>
  <script>
    const p = new URLSearchParams(location.search);
    const iss = p.get("iss");
    const launch = p.get("launch");

    if (!iss || !launch) {
      document.getElementById("status").textContent =
        "Missing 'iss' or 'launch'. Launch this app from the EHR.";
    } else {
      document.getElementById("status").textContent = "Redirecting to Epic authorize...";

      FHIR.oauth2.authorize({
        clientId: "2b4759e7-6f7f-49e6-b1ab-c38d02f83bc7",
        redirectUri: "https://drlalithapranathi.github.io/epic-smart-claims/index.html",
        iss,
        launch,
        completeInTarget: true,
        scope: "patient/demographics"
      });
    }
  </script>
</body>
</html>
